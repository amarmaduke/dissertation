\chapter{Proof of Preservation}
\label{ap:b}

\input{figures/02/domain.tex}
\input{figures/02/infer1.tex}
\input{figures/02/infer2.tex}
\input{figures/02/infer3.tex}

\begin{lemma}
    \textcolor{white}{\_}
    \begin{enumerate}
        \item If $\Gamma \vdash t \infr A$ then $t\pseobj$
        \item If $\Gamma \vdash t \cinfr A$ then $t\pseobj$
        \item If $\Gamma \vdash t \chck A$ then $t\pseobj$
    \end{enumerate}
    \label{lem:2:infer_is_pseobj}
\end{lemma}
\begin{proof}
    By mutual induction.
    There are only two non-trivial, the rest hold immediately by the IH and applying the associated rule.
    Well-formed context cases are omitted because they are not used in the induction.

    $\text{Case: }\begin{array}{c}\begin{minipage}{0.7\textwidth}$\PairRule[*]$ \end{minipage}\end{array}$
    \begin{proofcase}
        By the IH $t\pseobj$, $s\pseobj$, and $(x : A) \cap B\pseobj$.
        By Theorem~\ref{thm:2:beta_iff_conv} $|t| \betaconv |s|$.
        Applying the pair rule yields $[t,s;(x : A) \cap B]\pseobj$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c}\begin{minipage}{0.7\textwidth} $\LambdaRule[*]$ \end{minipage}\end{array}$
    \begin{proofcase}
        Consider only the case when $m = 0$ as the other cases are trivial.
        By the IH $A\pseobj$ and $t\pseobj$.
        Because $m = 0$, $x \notin FV(|t|)$.
        Thus, applying the lambda rule yields $\abs{\lambda_0}{x}{A}{t}\pseobj$.
    \end{proofcase}
\end{proof}

\outline{Define the lifting of reduction to contexts}

\begin{lemma}
    If $\Gamma \vdash t \infr A$ or $\Gamma \vdash t \cinfr A$ or $\Gamma \vdash t \chck A$ then $\vdash \Gamma$
    \label{lem:2:ctx_wf}
\end{lemma}
\begin{proof}
    Straightforward by induction, all leaves of a derivation have $\vdash \Gamma$ as a premise.
\end{proof}

\begin{lemma}[Weakening]
    Suppose $\Gamma \vdash B \cinfr K$ for $K = \kind$ or $K = \star$.
    \begin{enumerate}
        \item If $\Gamma, \Delta \vdash t \infr A$ then $\Gamma, x : B, \Delta \vdash t \infr A$
        \item If $\Gamma, \Delta \vdash t \cinfr A$ then $\Gamma, x : B, \Delta \vdash t \cinfr A$
        \item If $\Gamma, \Delta \vdash t \chck A$ then $\Gamma, x : B, \Delta \vdash t \chck A$
        \item if $\vdash \Gamma, \Delta$ then $\vdash \Gamma, x : B, \Delta$
    \end{enumerate}
    \label{lem:2:weaken}
\end{lemma}
\begin{proof}
    By mutual induction.
    Omitted cases follow immediately from application of the IH to all subderivations and applying the associated rule of the case.

    $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
    \begin{proofcase}
        By the IH on $\D{1}$: $\vdash \Gamma, x : B, \Delta$.
        Applying the \textsc{Axiom} rule concludes this case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
    \begin{proofcase}        
        By the IH on $\D{1}$: $\vdash \Gamma, x : B, \Delta$.
        If $(y : A) \in \Gamma$ then clearly $(y : A) \in \Gamma, x : B, \Delta$.
        Thus, applying the \textsc{Var} rule concludes.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
    \begin{proofcase}
        Applying the IH to $\D{2}$ gives $\Gamma, x : B, \Delta, y : A \vdash B \cinfr \pcodom(m)$.
        Notice that $\Delta$ is generalized in the induction hypothesis, thus allowing for the capture of the additional context assumption introduced in $\D{2}$.
        Applying the IH to $\D{1}$ and the \textsc{Pi} rule concludes.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
    \begin{proofcase}
        By the \textsc{CtxEm} rule.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
    \begin{proofcase}
        By the IH on $\D{2}$: $\vdash \Gamma, x : B, \Delta$.
        By the IH on $\D{3}$: $\Gamma, x : B, \Delta \vdash A \cinfr K$.
        Recall that renaming is applied implicitly to preserve meaning.
        In this case, either $\Gamma$ and $\Delta$ could be renamed so that $x$ is unique, or $x$ itself renamed so that $x \notin FV(\Gamma, \Delta)$.
        Either way some conclusion of the following form is obtained: Pick $y \notin FV(\Gamma, \Delta)$ and $y \neq x$.
        Thus, $\vdash \Gamma, x : B, \Delta, y : A$.
    \end{proofcase}
\end{proof}

\begin{lemma}
    If $\vdash \Gamma$ and $(x : A) \in \Gamma$ then $\exists\ K$ such that $\Gamma \vdash A \cinfr K$, where $K = \kind$ or $K = \star$
    \label{lem:2:ctx_get}
\end{lemma}
\begin{proof}
    By definition, $\exists\ \Delta_1, \Delta_2$ such that $\Gamma = \Delta_1, x : A, \Delta_2$ and $\Delta_1 \vdash A \cinfr K$.
    By weakening, $\Delta_1, x : A \vdash A \cinfr K$.
    Induction on $\Delta_2$ and repeated application of weakening concludes the proof.
\end{proof}

\begin{lemma}
    \textcolor{white}{\_}
    \begin{enumerate}
        \item If $\Gamma \vdash t \infr A$ then $A\pseobj$
        \item If $\Gamma \vdash t \cinfr A$ then $A\pseobj$
        \item If $\Gamma \vdash t \chck A$ then $A\pseobj$
    \end{enumerate}
    \label{lem:2:infer_type_is_pseobj}
\end{lemma}
\begin{proof}
    By mutual induction.
    Cases where $A\pseobj$ trivially by application of a finite number of rules are omitted.
    The well-formed context cases are omitted because they are not used in the mutual induction.

    $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
    \begin{proofcase}
        By Lemma~\ref{lem:2:ctx_get} and Lemma~\ref{lem:2:infer_is_pseobj}.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
    \begin{proofcase}
        Applying the \textsc{Pi} rule with $\D{1}$ and $\D{3}$ gives $\Gamma \vdash (x : A) \to_m B \infr \pcodom(m)$.
        By Lemma~\ref{lem:2:infer_is_pseobj} the case concludes.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
    \begin{proofcase}
        Deconstruction and inversion on $\D{1}$ yields the judgment $\Gamma, x : A \vdash B \cinfr \pcodom(m)$.
        Thus, by Lemma~\ref{lem:2:infer_is_pseobj}: $B\pseobj$ and $a\pseobj$.
        Finally, by Lemma~\ref{lem:2:pseobj_subst} $[x := a]B\pseobj$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
    \begin{proofcase}
        By Lemma~\ref{lem:2:infer_is_pseobj} applied to $\D{1}$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \FirstRule[*] \end{array}$
    \begin{proofcase}
        By the IH $(x : A) \cap B \pseobj$ which means $A\pseobj$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
    \begin{proofcase}
        By the IH $(x : A) \cap B \pseobj$ which means $B\pseobj$.
        The \textsc{Fst} rule applied to $\D{1}$ gives $\Gamma \vdash t.1 \infr A$.
        By Lemma~\ref{lem:2:infer_is_pseobj}: $t.1\pseobj$.
        Finally, by Lemma~\ref{lem:2:pseobj_subst} $[x := t.1]B\pseobj$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ReflRule[*] \end{array}$
    \begin{proofcase}
        By Lemma~\ref{lem:2:infer_is_pseobj} $t\pseobj$ and $A\pseobj$.
        Applying the constructor rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
    \begin{proofcase}
        By the IH $a =_A b\pseobj$ which means $a\pseobj$, $b\pseobj$, and $A\pseobj$.
        By Lemma~\ref{lem:2:infer_is_pseobj}: $P\pseobj$.
        The constructor rule yields $\app{P}{\tau}{a}\pseobj$ and $\app{P}{\tau}{b}\pseobj$.
        The binder rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PromoteFstRule[*] \end{array}$
    \begin{proofcase}
        By the IH $a.1 =_A b.1\pseobj$ and $(x : A) \cap B\pseobj$. Which means $a\pseobj$ and $b\pseobj$.
        Applying the constructor rule finishes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
    \begin{proofcase}
        By the IH $a.2 =_{[x := a.1]B} b.2\pseobj$ and $(x : A) \cap B\pseobj$. Which means $a\pseobj$ and $b\pseobj$.
        Applying the constructor rule finishes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
    \begin{proofcase}
        Immediate by the IH applied to $\D{1}$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
    \begin{proofcase}
        By the IH applied to $\D{1}$: $A\pseobj$.
        By Lemma~\ref{lem:2:pseobj_preservation}: $B\pseobj$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
    \begin{proofcase}
        By Lemma~\ref{lem:2:infer_is_pseobj} on $\D{2}$: $B\pseobj$.
    \end{proofcase}
\end{proof}

\begin{lemma}[Substitution of Inference]
    Suppose $\Gamma \vdash b \infr B$.
    \begin{enumerate}
        \item If $\Gamma, x : B, \Delta \vdash t \infr A$ then $\Gamma, [x := b]\Delta \vdash [x := b]t \infr [x := b]A$
        \item If $\Gamma, x : B, \Delta \vdash t \cinfr A$ then $\Gamma, [x := b]\Delta \vdash [x := b]t \cinfr [x := b]A$
        \item If $\Gamma, x : B, \Delta \vdash t \chck A$ then $\Gamma, [x := b]\Delta \vdash [x := b]t \chck [x := b]A$
        \item If $\vdash \Gamma, x : B, \Delta$ then $\vdash \Gamma, [x := b]\Delta$
    \end{enumerate}
    \label{lem:2:subst_infer}
\end{lemma}
\begin{proof}
    By mutual induction.
    Omitted cases are obtained by applying the IH to all subderivations and applying the associated rule.

    $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
    \begin{proofcase}
        Applying the IH to $\D{1}$ gives $\vdash \Gamma, [x := b]\Delta$.
        Using the \textsc{Axiom} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
    \begin{proofcase}
        Rename the case to $\Gamma \vdash y \infr A$.
        By the IH applied to $\D{1}$: $\vdash \Gamma, [x := b]\Delta$.
        Suppose $y \neq x$.
        Then $(y : A) \in \Gamma, x : B, \Delta$ implies $(y : A) \in \Gamma, [x := b]\Delta$.
        Applying the \textsc{Var} rule concludes this case.
        Suppose $y = x$.
        Then $[x := b]y = b$ and $A = B$.
        Recall that $\Gamma \vdash b \infr B$.
        It must be the case that $x \notin FV(\Gamma)$ by $\D{1}$.
        Thus, $x \notin FV(B)$ and $[x := b]B = B$.
        Finally, by weakening $\Gamma, [x := b]\Delta \vdash b \infr B$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
    \begin{proofcase}
        By the IH applied to $\D{1}$: $\Gamma, [x := b]\Delta \vdash [x := b]A \cinfr \pdom(m, K)$.
        By the IH applied to $\D{2}$: $\Gamma, [x := b]\Delta, y : [x := b]A \vdash [x := b]B \cinfr \pcodom(m)$.
        Applying the \textsc{Pi} rule gives $\Gamma, [x := b]\Delta \vdash (y : [x := b]A) \to_m [x := b]B \infr \pcodom(m)$.
        Folding substitution concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
    \begin{proofcase}
        As with the previous case, applying the IH to $\D{1}$, $\D{2}$, and $\D{3}$ yield the necessary subderivations to build the desired term with the \textsc{Lam} rule.
        Note that the substituted variable, $x$, cannot be equal to the bound variable, $y$, by implicit renaming.
        Moreover, $y \notin FV([x := b]|t|)$ if $m = 0$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
    \begin{proofcase}
        Applying the IH gives, for $\D{1}$: $\Gamma, [x := b]\Delta \vdash [x := b]f \cinfr (y : [x := b]A) \to_m [x := b]B$, and for $\D{2}$: $\Gamma, [x := b]\Delta \vdash [x := b]a \chck [x := b]A$.
        Thus, applying the \textsc{App} rule gives $\Gamma, [x := b]\Delta \vdash \app{([x := b]f)}{m}{([x := b]a)} \infr [y := [x := b]a][x := b]B$.
        By Lemma~\ref{lem:2:subst_commute} $[y := [x := b]a][x := b] = [x := b][y := a]$.
        Thus, $\Gamma, [x := b]\Delta \vdash [x := b](\app{f}{m}{a}) \infr [x := b][y := a]B$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
    \begin{proofcase}
        Applying the IH to $\D{3}$ gives $\Gamma, [x := b]\Delta \vdash [x := b]s \chck [x := b][y := t]B$.
        Notice that the bound variable is renamed to $y$ implicitly.
        By Lemma~\ref{lem:2:subst_commute} $[x := b][y := t]B = [y := [x := b]t][x := b]B$.
        Applying Lemma~\ref{lem:2:infer_is_pseobj} to $\D{2}$ and $\D{3}$ gives $t\pseobj$ and $s\pseobj$.
        Then, by Lemma~\ref{lem:2:conv_subst} applied to $\D{4}$: $[x := b]t \equiv [x := b]s$.
        The IH applied to $\D{1}$ and $\D{2}$ and the application of the \textsc{Pair} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
    \begin{proofcase}
        Applying the IH to $\D{1}$ gives $\Gamma, [x := b]\Delta \vdash [x := b]t \cinfr (y : [x := b]A) \cap [x := b]B$.
        The \textsc{Snd} rule and some folding of substitution yields $\Gamma, [x := b]\Delta \vdash [x := b]t.2 \infr [y := [x := b]t.1][x := b]B$.
        Finally, by Lemma~\ref{lem:2:subst_commute} $[y := [x := b]t.1][x := b]B = [x := b][y := t.1]B$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
    \begin{proofcase}
        Deconstructing $\D{1}$ and using inversion yields $\Gamma \vdash A \cinfr \star$ and $\Gamma \vdash A^\prime \cinfr \star$.
        Applying Lemma~\ref{lem:2:infer_is_pseobj} means that $A\pseobj$ and $A^\prime\pseobj$.
        Then, by Lemma~\ref{lem:2:conv_subst} applied to $\D{2}$: $[x := b]A \equiv [x := b]A^\prime$.
        To see why $FV(|[x := b]e|)$ is empty, consider that if $x$ is in a free position in $e$, then necessarily $x \in FV(|e|)$, which is not true.
        Thus, $x$ can only be in an erased position in $e$, but then $|[x := b]e| = |e|$, because $x$ is erased, so its substituted term must also be erased.
        Applying the IH to $\D{1}$ and $\D{3}$ and using the \textsc{Cast} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
    \begin{proofcase}
        By the IH applied to $\D{1}$: $\Gamma, [x := b]\Delta \vdash [x := b]e \chck [x := b]\text{ctt} =_{[x := b]\text{cBool}} [x := b]\text{cff}$.
        However, ctt, cff and cBool are all closed terms, thus $[x := b]\text{ctt} = \text{ctt}$, etc.
        Moreover, $[x := b]((X : \star) \to_0 X) = (X : \star) \to_0 X$.
        Thus, applying the \textsc{Sep} rule concludes.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
    \begin{proofcase}
        By Lemma~\ref{lem:2:betastar_subst} $[x := b]A \betastar [x := b]B$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
    \begin{proofcase}
        By Lemma~\ref{lem:2:infer_type_is_pseobj}: $A\pseobj$.
        By Lemma~\ref{lem:2:infer_is_pseobj}: $B\pseobj$.
        Then, by Lemma~\ref{lem:2:conv_subst} $[x := b]A \equiv [x := b]B$.
        Note that $[x := b]K = K$ because $K = \star$ or $K = \kind$.
        The case concludes by applying the IH to $\D{1}$ and $\D{2}$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
    \begin{proofcase}
        Impossible by inversion, context is not empty.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
    \begin{proofcase}
        By the IH applied to $\D{2}$: $\vdash \Gamma, [x := b]\Delta$.
        The IH applied to $\D{3}$: $\Gamma, [x := b]\Delta \vdash [x := b]A \cinfr K$.
        Pick $y \notin FV(\Gamma)$.
        Applying the \textsc{CtxApp} rule gives $\vdash \Gamma, [x := b]\Delta, y : [x := b]A$.
    \end{proofcase}
\end{proof}


\begin{lemma}[Substitution of Checking]
    Suppose $\Gamma \vdash b \chck B$.
    \begin{enumerate}
        \item If $\Gamma, x : B, \Delta \vdash t \infr A$ then $\Gamma, [x := b]\Delta \vdash [x := b]t \chck [x := b]A$
        \item If $\Gamma, x : B, \Delta \vdash t \cinfr A$ then $\Gamma, [x := b]\Delta \vdash [x := b]t \chck [x := b]A$
        \item If $\Gamma, x : B, \Delta \vdash t \chck A$ then $\Gamma, [x := b]\Delta \vdash [x := b]t \chck [x := b]A$
        \item If $\vdash \Gamma, x : B, \Delta$ then $\vdash \Gamma, [x := b]\Delta$
    \end{enumerate}
    \label{lem:2:subst_check}
\end{lemma}
\begin{proof}
    By mutual induction.

    $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
    \begin{proofcase}
        Applying the IH to $\D{1}$ gives $\Gamma, [x := b]\Delta \vdash [x := b]A \cinfr \pdom(m, K)$.
        Using the IH on $\D{2}$ yields $\Gamma, [x := b]\Delta, x_m : [x := b]A \vdash [x := b]t \chck [x := b]B$.
        Deconstructing this judgment means that $\Gamma, [x := b]\Delta, x_m : [x := b]A \vdash [x := b]t \infr T$ with $T \equiv [x := b]B$.
        
        Now using the IH with $\D{3}$ gives $\Gamma, [x := b]\Delta, x_m : [x := b]A \vdash [x := b]B \cinfr \pcodom(m)$.
        But this forces $K = \pcodom(m)$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \IntersectionRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \FirstRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ReflRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PromoteFstRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
    \begin{proofcase}
        TODO
    \end{proofcase}
\end{proof}


\begin{lemma}
    If $\Gamma \vdash A \cinfr K_1$, $\Gamma \vdash B \cinfr K_2$, and $A \equiv B$ then $K_1 = K_2$
    \label{lem:2:conv_proof_force_equal_types}
\end{lemma}

% TODO: check 12 and 13 for fixes

\begin{theorem}
    \textcolor{white}{\_}
    \begin{enumerate}
        \item $\Gamma \vdash t \infr A$ and $\Gamma \betared \Gamma^\prime$ then $\exists\ A^\prime.$ $A \betastar A^\prime$ and $\Gamma^\prime \vdash t \infr A^\prime$
        \item $\Gamma \vdash t \cinfr A$ and $\Gamma \betared \Gamma^\prime$ then $\exists\ A^\prime.$ $A \betastar A^\prime$ and $\Gamma^\prime \vdash t \cinfr A^\prime$
        \item $\Gamma \vdash t \chck A$ and $\Gamma \betared \Gamma^\prime$ then $\Gamma^\prime \vdash t \chck A$
        \item $\vdash \Gamma$ and $\Gamma \betared \Gamma^\prime$ then $\vdash \Gamma^\prime$
        \item $\Gamma \vdash t \infr A$, $\Gamma \betared \Gamma^\prime$, and $t \betared t^\prime$ then \\ $\exists\ A^\prime.$ $A \equiv A^\prime$, $(A^\prime = \kind \vee \Gamma^\prime \vdash A^\prime \cinfr K)$, and $\Gamma^\prime \vdash t^\prime \infr A^\prime$
        \item $\Gamma \vdash t \cinfr A$, $\Gamma \betared \Gamma^\prime$, and $t \betared t^\prime$ then \\ $\exists\ A^\prime.$ $A \equiv A^\prime$, $(A^\prime = \kind \vee \Gamma^\prime \vdash A^\prime \cinfr K)$, and $\Gamma^\prime \vdash t^\prime \cinfr A^\prime$
        \item $\Gamma \vdash t \chck A$, $\Gamma \betared \Gamma^\prime$, and $t \betared t^\prime$ then $\Gamma^\prime \vdash t^\prime \chck A$
        \item $\Gamma \vdash t \chck A$, $\Gamma \betared \Gamma^\prime$, $t \betared t^\prime$, and $A \betared A^\prime$ then $\Gamma^\prime \vdash t^\prime \chck A^\prime$
        \item $\Gamma \vdash t \infr A$ and $\Gamma \betastar \Gamma^\prime$ then $\exists\ A^\prime.$ $A \betastar A^\prime$ and $\Gamma^\prime \vdash t \infr A^\prime$
        \item $\Gamma \vdash t \cinfr A$ and $\Gamma \betastar \Gamma^\prime$ then $\exists\ A^\prime.$ $A \betastar A^\prime$ and $\Gamma^\prime \vdash t \cinfr A^\prime$
        \item $\vdash \Gamma$ and $\Gamma \betastar \Gamma^\prime$ then $\vdash \Gamma^\prime$
        \item $\Gamma \vdash t \infr A$, $\Gamma \betastar \Gamma^\prime$, and $t \betastar t^\prime$ then \\ $\exists\ A^\prime.$ $A \equiv A^\prime$, $(A^\prime = \kind \vee \Gamma^\prime \vdash A^\prime \cinfr K)$, and $\Gamma^\prime \vdash t^\prime \infr A^\prime$
        \item $\Gamma \vdash t \cinfr A$, $\Gamma \betastar \Gamma^\prime$, and $t \betastar t^\prime$ then \\ $\exists\ A^\prime.$ $A \equiv A^\prime$, $(A^\prime = \kind \vee \Gamma^\prime \vdash A^\prime \cinfr K)$, and $\Gamma^\prime \vdash t^\prime \cinfr A^\prime$
        \item $\Gamma \vdash t \chck A$, $\Gamma \betastar \Gamma^\prime$, $t \betastar t^\prime$, and $A \betastar A^\prime$ then $\Gamma^\prime \vdash t^\prime \chck A^\prime$
        \item $\Gamma, x : C, \Delta \vdash t \infr A$, $C \equiv C^\prime$, and $\Gamma \vdash C^\prime \vdash K$ then \\ $\exists\ A^\prime.$ $A \equiv A^\prime$, $(A^\prime = \kind \vee \Gamma^\prime \vdash A^\prime \cinfr K)$, and $\Gamma, x : C^\prime, \Delta \vdash t\infr A^\prime$
        \item $\Gamma, x : C, \Delta \vdash t \cinfr A$, $C \equiv C^\prime$, and $\Gamma \vdash C^\prime \vdash K$  then \\ $\exists\ A^\prime.$ $A \equiv A^\prime$, $(A^\prime = \kind \vee \Gamma^\prime \vdash A^\prime \cinfr K)$, and $\Gamma, x : C^\prime, \Delta \vdash t \cinfr A^\prime$
        \item $\Gamma, x : C, \Delta \vdash t \chck A$, $C \equiv C^\prime$, and $\Gamma \vdash C^\prime \vdash K$  then $\Gamma, x : C^\prime, \Delta \vdash t \chck A$
        \item $\vdash \Gamma, x : C, \Delta$, $C \equiv C^\prime$, and $\Gamma \vdash C^\prime \vdash K$ then $\vdash \Gamma, x : C^\prime, \Delta$
    \end{enumerate}
\end{theorem}
\begin{proof}
    The proof proceeds by well-founded mutual recursion.

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 1
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{1.}} By pattern-match on $\Gamma \vdash t \infr A$.
    The \textsc{Refl}, \textsc{Int}, \textsc{Fst}, and \textsc{PrmFst} cases are omitted because they are very similar to the \textsc{Lam}, \textsc{Pi}, \textsc{Snd}, and \textsc{PrmSnd} cases respectively.

    $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{4} to $\D{1}$ gives $\vdash \Gamma^\prime$.
        The \textsc{Ax} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{4} to $\D{1}$ gives $\vdash \Gamma^\prime$.
        Suppose wlog that $A \betared A^\prime$ in $\Gamma \betared \Gamma^\prime$.
        Then $(x_m : A^\prime) \in \Gamma^\prime$.
        Thus, $\Gamma^\prime \vdash x \infr A^\prime$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{2} on $\D{1}$ gives $\Gamma^\prime \vdash A \cinfr T$ with $\pdom(m, K) \betastar T$, but this reduction forces $T = \pdom(m, K)$.
        Note that $\Gamma, x_m : A \betared \Gamma^\prime, x_m : A$.
        Applying \textit{2} on $\D{2}$ with the previous reduction gives $\Gamma^\prime, x_m : A \vdash B \cinfr \pcodom(m)$.
        Where the reduction-inferred type is $\pcodom(m)$ for the same reason as previously.
        The \textsc{Pi} rule concludes.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
    \begin{proofcase}
        As with the previous case: $\Gamma^\prime \vdash A \cinfr \pdom(m, K)$.
        Applying \textit{1} on $\D{2}$ gives $\Gamma^\prime, x_m : A \vdash t \infr B^\prime$ with $B \betastar B^\prime$.
        Now, applying \textit{13} to $\D{3}$ yields $\Gamma^\prime, x_m : A \vdash B^\prime \cinfr \pcodom(m)$ noting that the reduction-inferred type is unchanged for the same reasons as before.
        Thus, $\Gamma^\prime \vdash \abs{\lambda_m}{x}{A}{t} \infr (x : A) \to_m B^\prime$ with $(x : A) \to_m B \betastar (x : A) \to_m B^\prime$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{2} on $\D{1}$ gives $\Gamma^\prime \vdash f \cinfr T$ with $(x : A) \to_m B \betastar T$.
        By inversion on the previous reduction $T = (x : A^\prime) \to_m B^\prime$ with $A \betastar A^\prime$ and $B \betastar B^\prime$.
        Using \textit{14} on $\D{2}$ gives $\Gamma^\prime \vdash a \chck A^\prime$.
        Now by the \textsc{App} rule $\Gamma^\prime \vdash \app{f}{m}{a} \infr [x := a]B^\prime$.
        Finally, by Lemma~\ref{lem:2:betastar_subst} $[x := a]B \betastar [x:= a]B^\prime$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
    \begin{proofcase}
        Using \textit{1} on $\D{1}$ gives $\Gamma^\prime \vdash (x : A) \cap B \infr \star$.
        Again, note that technically a new term is introduced such that $\star \betastar T$, but this requires $T = \star$.
        Applying \textit{4} with $\D{2}$, $\D{3}$, and applying the \textsc{Pair} rule conclude the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
    \begin{proofcase}
        Using \textit{2} on $\D{1}$ gives $\Gamma^\prime \vdash t \cinfr T$ with $(x : A) \cap B \betastar T$.
        By inversion on this reduction $T = (x : A^\prime) \cap B^\prime$ with $A \betastar A^\prime$ and $B \betastar B^\prime$.
        Now with Lemma~\ref{lem:2:betastar_subst} $[x := t.1]B \betastar [x := t.1]B^\prime$.
        The \textsc{Snd} rule concludes.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{2} on $\D{1}$ gives $\Gamma^\prime \vdash A \cinfr \star$.
        Now using \textit{3} on $\D{2}$, $\D{3}$, and applying the \textsc{Eq} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
    \begin{proofcase}
        Using \textit{2} on $\D{1}$ yields $\Gamma^\prime \vdash e \cinfr T$ with $a =_A b \betastar T$.
        By inversion on the previous reduction $T = a^\prime =_{A^\prime} b^\prime$ with $a \betastar a^\prime$, $A \betastar A^\prime$, and $b \betastar b^\prime$.
        Note that $A \to_\tau \star \betastar A^\prime \to_\tau \star$ and using this with \textit{14} on $\D{2}$ gives $\Gamma^\prime \vdash P \chck A^\prime \to_\tau \star$.
        Finally, note that $\app{P}{\tau}{a} \to_\omega \app{P}{\tau}{b} \betastar \app{P}{\tau}{a^\prime} \to_\omega \app{P}{\tau}{b^\prime}$.
        Thus, the \textsc{Subst} rule concludes.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
    \begin{proofcase}
        Using \textit{2} on $\D{1}$ gives $\Gamma^\prime \vdash a \cinfr T$ with $(x : A) \cap B \betastar T$.
        Inversion on this reduction gives $T = (x : A^\prime) \cap B^\prime$ with $A \betastar A^\prime$ and $B \betastar B^\prime$.
        By Lemma~\ref{lem:2:betastar_subst} $[x := a.1]B \betastar [x := a.1]B^\prime$.
        Thus, $a.2 =_{[x := a.1]B} = b.2 \betastar a.2 =_{[x := a.1]B^\prime} = b.2$.
        Using \textit{14} with the appropriate reductions and applying the \textsc{PrmSnd} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
    \begin{proofcase}
        Using \textit{2} on $\D{1}$ gives $\Gamma^\prime \vdash f \cinfr T$ with $(a : A) \to_\omega (x : C) \cap B \betastar T$.
        Inversion on this previous reduction gives $T = (a : A^\prime) \to_\omega (x : C^\prime) \cap B^\prime$ with $A \betastar A^\prime$, $C \betastar C^\prime$, and $B \betastar B^\prime$.
        Note that $A \equiv C$ and thus by Lemma~\ref{lem:2:conv_red_f} $A^\prime \equiv C^\prime$.
        Now $(a : A) \to_\omega a =_A (\app{f}{\omega}{a}).1 \betastar (a : A^\prime) \to_\omega a =_{A^\prime} (\app{f}{\omega}{a}).1$.
        Using \textit{14} on $\D{3}$ also with the previous reduction gives $\Gamma^\prime \vdash e \chck (a : A^\prime) \to_\omega a =_{A^\prime} (\app{f}{\omega}{a}).1$.
        The \textsc{Cast} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
    \begin{proofcase}
        Immediate by applying \textit{3} to $\D{1}$ and using the \textsc{Sep} rule.
    \end{proofcase}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 2
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{2.}} By pattern-match on $\Gamma \vdash t \cinfr A$.

    $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
    \begin{proofcase}
        Using \textit{1} on $\D{1}$ gives $\Gamma^\prime \vdash t \infr A^\prime$ with $A \betastar A^\prime$.
        Confluence yields $B^\prime$ such that $A^\prime \betastar B^\prime$ and $B \betastar B^\prime$.
        Thus, $A \betastar B^\prime$ and the \textsc{RedInf} rule concludes.
    \end{proofcase}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 3
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{3.}} By pattern-match on $\Gamma \vdash t \chck A$.

    $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
    \begin{proofcase}
        Using \textit{1} on $\D{2}$ gives $\Gamma^\prime \vdash t \cinfr A^\prime$ with $A \betastar A^\prime$.
        Suppose $B \neq \kind$ wlog.
        Applying \textit{2} on $\D{1}$ yields $\Gamma^\prime \vdash B \cinfr K$.
        Now by Lemma~\ref{lem:2:conv_red_f}: $A^\prime \equiv B$.
        Thus, $\Gamma^\prime \vdash t \chck B$.
    \end{proofcase}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 4
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{4.}} By pattern-match on $\vdash \Gamma$.

    $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
    \begin{proofcase}
        Have $\varepsilon \betastar \Gamma^\prime$, but this forces $\Gamma^\prime = \varepsilon$.
        The \textsc{CtxEm} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{5} on $\D{2}$ gives $\vdash \Gamma^\prime$.
        Suppose wlog that $A \betared A^\prime$.
        Using \textit{13} on $\D{3}$ gives $\Gamma^\prime \vdash A^\prime \cinfr T$ where $T \equiv K$.
        Thus, $|T| \betastar K$.
        However, by Lemmas~\ref{lem:2:substar_not_beta_star} and $\kind$ not being a subexpression, this forces $T = K$.
        Note that context reduction does not create free variables, thus $x \notin FV(\Gamma^\prime)$.
        The \textsc{CtxApp} rule concludes.
    \end{proofcase}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 5
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{5.}}
    By pattern-match on $\Gamma \vdash t \infr A$.
    The \textsc{Refl}, \textsc{Int}, \textsc{Fst}, and \textsc{PrmFst} cases are omitted because they are very similar to the \textsc{Lam}, \textsc{Pi}, \textsc{Snd}, and \textsc{PrmSnd} cases respectively.
    The \textsc{Var} and \textsc{Ax} cases are omitted by inversion $\neg (\star \betared t)$ and $\neg (x \betared t)$.

    $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
    \begin{proofcase}
        Suppose $A \betared A^\prime$.
        Applying \textit{6} to $\D{2}$ gives $\Gamma^\prime \vdash A \cinfr T_1$ with $T_1 \equiv \pdom(m, K)$.
        However, this forces $T_1 = \pdom(m, K)$.
        Note that $\Gamma, x_m : A \betared \Gamma^\prime, x_m : A^\prime$.
        Using \textit{2} with $\D{2}$ yields $\Gamma^\prime, x_m : A^\prime \vdash B \cinfr T_2$ with $T_2 \betastar \pcodom(m)$, but this forces $T_2 = \pcodom(m)$.
        The \textsc{Pi} rule concludes.
        \\ \\
        Suppose $B \betared B^\prime$.
        Note that $\Gamma, x_m : A \betared \Gamma^\prime, x_m : A$.
        Applying \textit{6} to $\D{2}$ gives $\Gamma^\prime, x_m : A \vdash B^\prime \cinfr T$ with $T \equiv \pcodom(m)$.
        However, this forces $T = \pcodom(m)$.
        Thus, the \textsc{Pi} rule concludes the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
    \begin{proofcase}
        Suppose $A \betared A^\prime$.
        Applying \textit{6} to $\D{1}$ gives $\Gamma^\prime \vdash A^\prime \cinfr \pdom(m, K)$.
        Note that $\Gamma, x_m : A \betared \Gamma^\prime, x_m : A^\prime$.
        Using \textit{1} with $\D{2}$ yields $\Gamma^\prime, x_m : A^\prime \vdash t \infr B^\prime$ with $B \betastar B^\prime$.
        Now \textit{13} applied to $\D{3}$ gives $\Gamma^\prime, x_m : A^\prime \vdash B^\prime \cinfr \pcodom(m)$.
        By the \textsc{Pi} rule $\Gamma^\prime \vdash (x : A) \to_m B^\prime \infr \pcodom(m)$.
        Note that $(x : A) \to_m B^\prime \equiv (x : A) \to_m B$.
        Thus, the \textsc{Lam} rule concludes.
        \\ \\
        Suppose $t \betared t^\prime$.
        Note that $\Gamma, x_m : A \betared \Gamma^\prime, x_m : A$.
        Applying \textit{5} to $\D{2}$ gives $\Gamma^\prime, x_m : A \vdash t^\prime \infr B^\prime$ with $B \equiv B^\prime$ and $\Gamma^\prime \vdash B^\prime \cinfr K$.
        Using \textit{2} with $\D{3}$ yields $\Gamma^\prime, x_m : A \vdash B \cinfr \pcodom(m)$.
        Now by Lemma~\ref{lem:2:conv_proof_force_equal_types} $K = \pcodom(m)$.
        Applying \textit{2} to $\D{1}$ gives $\Gamma^\prime \vdash A \cinfr \pdom(m, K)$.
        Note that reduction does not create free variables, thus $x \notin FV(|t|)$ when $m = 0$.
        Observe that $\Gamma^\prime \vdash (x : A) \to_m B^\prime \infr \pcodom(m)$ by the \textsc{Pi} rule and that $(x : A) \to_m B^\prime \equiv (x : A) \to_m B$.
        Finally, $\Gamma^\prime \vdash \abs{\lambda_m}{x}{A}{t^\prime} \infr (x : A) \to_m B^\prime$ by the \textsc{Lam} rule.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
    \begin{proofcase}
        Suppose $f = \abs{\lambda_m}{x}{C}{t}$ and $\app{f}{m}{a} \betared [x := a]t$.
        Deconstructing $\D{1}$ gives $\Gamma \vdash \abs{\lambda_m}{x}{C}{t} \infr (x : C) \to_m D$ with $C \betastar A$ and $D \betastar B$.
        Deconstructing again yields $\Gamma, x : C \vdash t \infr D$ and $\Gamma, x : C \vdash D \cinfr \pcodom(m)$.
        Now, deconstructing $\D{2}$ gives $\Gamma \vdash a \infr T$ with $T \equiv A$ and $\Gamma \vdash A \cinfr K$.
        Note that $T \equiv C$ by transitivity of reduction.
        Observe that $\Gamma, x : C \equiv \Gamma, x : T$.
        Using \textit{15} on $\Gamma, x : C \vdash t \infr D$ gives $\Gamma, x : T \vdash t \infr D^\prime$ where $D \equiv D^\prime$ and $\Gamma, x : T \vdash D^\prime \cinfr K_2$.
        Using \textit{15} on $\Gamma, x : C \vdash D \cinfr \pcodom(m)$ yields $\Gamma, x : T \vdash D \cinfr \pcodom(m)$.
        By Lemma~\ref{lem:2:conv_proof_force_equal_types} $K_2 = \pcodom(m)$.
        Using Lemma~\ref{lem:2:subst_infer}: $\Gamma \vdash [x := a]t \infr [x := a]D^\prime$ and $\Gamma \vdash [x := a]D^\prime \cinfr \pcodom(m)$.
        Recall that $D \betastar B$ and $D \equiv D^\prime$, thus $B \equiv D^\prime$ by Lemma~\ref{lem:2:conv_red_f}.
        By Lemma~\ref{lem:2:conv_subst} $[x := a]B \equiv [x := a]D^\prime$.
        \\ \\
        Suppose $f \betared f^\prime$.
        TODO
        \\ \\
        Suppose $a \betared a^\prime$.
        TODO
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 6
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{6.}}
    By pattern-match on $\Gamma \vdash t \cinfr A$.

    $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{5} to $\D{1}$ gives $\Gamma^\prime \vdash t^\prime \cinfr A^\prime$ where $A \equiv A^\prime$.
        Pick $B^\prime = A^\prime$.
        Now $B^\prime \equiv B$ by Lemma~\ref{lem:2:conv_red_f}.
        Thus, $\Gamma^\prime \vdash t^\prime \cinfr B^\prime$ with $B \equiv B^\prime$.
    \end{proofcase}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 7
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{7.}}
    By pattern-match on $\Gamma \vdash t \chck A$.

    $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
    \begin{proofcase}
        Suppose wlog that $B \neq \kind$.
        Applying \textit{2} on $\D{1}$ gives $\Gamma^\prime \vdash B \cinfr K$.
        Using \textit{5} on $\D{2}$ yields $\Gamma^\prime \vdash t^\prime \infr A^\prime$ where $A \equiv A^\prime$.
        Now by Lemma~\ref{thm:2:conv_trans}: $A^\prime \equiv B$.
        Thus, $\Gamma^\prime \vdash t^\prime \chck B$.
    \end{proofcase}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 8
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{8.}}
    Deconstructing $\Gamma \vdash t \chck A$ gives $\Gamma \vdash t \infr T$, $\Gamma \vdash A \cinfr K$, and $T \equiv A$.
    Using \textit{5} yields $\Gamma^\prime \vdash t^\prime \infr T^\prime$ where $T \equiv T^\prime$.
    Applying \textit{6} give $\Gamma^\prime \vdash A^\prime \cinfr K$.
    Now by Lemma~\ref{thm:2:conv_trans} $T^\prime \equiv A$.

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 9
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{9.}}
    Suppose wlog that $\Gamma \betared \Delta$ and $\Delta \betastar \Gamma^\prime$.
    Applying \textit{1} gives $\Delta \vdash t \infr A^\prime$ with $A \betastar A^\prime$.
    Now using \textit{9}: $\Gamma^\prime \vdash t \infr B$ with $A^\prime \betastar B$.
    By transitivity, $A \betastar B$.

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 10
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{10.}}
    Similar to \textit{9} using \textit{2} instead of \textit{1}.

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 11
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{11.}}
    Suppose wlog that $\Gamma \betared \Delta$ and $\Delta \betastar \Gamma^\prime$.
    Applying \textit{4} gives $\vdash \Delta$.
    Now using \textit{11}: $\vdash \Gamma^\prime$.

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 12
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{12.}}
    Note that the proof will proceed by recursion on reductions as opposed to derivations.
    Thus, as long as recursive calls are on sub-data of $a \betastar b$ the recursion is well-founded.
    First, pattern match on $\Gamma \betastar \Gamma^\prime$.
    Suppose $\Gamma^\prime = \Gamma$.
    Now pattern match on $t \betastar t^\prime$.
    \begin{enumerate}
        \item[-] {
            Suppose $t^\prime = t$, then no reduction is performed hence trivial.
        }
        \item[-] {
            Suppose $t \betared z$ and $z \betastar t^\prime$.
            Applying \textit{5} gives $\Gamma \vdash z \infr A^\prime$ where $A \equiv A^\prime$.
            Using \textit{12} gives $\Gamma \vdash t^\prime \infr B$ where $A^\prime \equiv B$.
            Now by Lemma~\ref{thm:2:conv_trans}: $A \equiv B$.
        }
    \end{enumerate}
    Suppose $\Gamma \betared \Delta$ and $\Delta \betastar \Gamma^\prime$.
    \begin{enumerate}
        \item[-] {
            Suppose $t^\prime = t$.
            Using \textit{1} gives $\Delta \vdash t \infr A^\prime$ where $A \betastar A^\prime$.
            Now using \textit{12}: $\Gamma^\prime \vdash t \infr B$ where $A^\prime \equiv B$.
            Note that, $A \equiv B$ by transitivity of reduction.
        }
        \item[-] {
            Suppose $t \betared z$ and $z \betastar t^\prime$.
            Applying \textit{5} yields $\Delta \vdash z \infr A^\prime$ where $A \equiv A^\prime$.
            Now using \textit{12} gives $\Gamma^\prime \vdash t^\prime \infr B$ where $A^\prime \equiv B$.
            Finally, by Lemma~\ref{thm:2:conv_trans}: $A \equiv B$.
        }
    \end{enumerate}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 13
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{13.}} Similar to the previous proof but using \textit{6} instead of \textit{5}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 14
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{14.}}
    Note that the proof will proceed by recursion on reductions as opposed to derivations.
    Thus, as long as recursive calls are on sub-data of $a \betastar b$ the recursion is well-founded.
    First, pattern match on $\Gamma \betastar \Gamma^\prime$.
    Suppose $\Gamma^\prime = \Gamma$.
    Now pattern match on $t \betastar t^\prime$.
    \begin{enumerate}
        \item[-] {
            Suppose $t^\prime = t$.
            Finally, pattern match on $A \betastar A^\prime$.
            \begin{enumerate}
                \item[-] {
                    Suppose $A^\prime = A$.
                    Then no reduction happened, and the case is trivial.
                }
                \item[-] {
                    Suppose $A \betared Y$ and $Y \betastar A^\prime$.
                    Deconstructing $\Gamma \vdash t \chck A$ gives $\Gamma \vdash t \infr T$, $\Gamma \vdash A \cinfr K$, and $T \equiv A$.
                    Applying \textit{6} yields $\Gamma \vdash Y \cinfr K$.
                    Note that technically this reduced-infers a new $T$ such that $T \equiv K$, but this forces $T = K$.
                    Now using \textit{14} gives $\Gamma \vdash A^\prime \cinfr K$.
                    By Lemma~\ref{lem:2:conv_red_f}: $T \equiv A^\prime$.
                    Thus, $\Gamma \vdash t \chck A^\prime$.
                }
            \end{enumerate}
        }
        \item[-] {
            Suppose $t \betared z$ and $z \betastar t^\prime$.
            Finally, pattern match on $A \betastar A^\prime$.
            \begin{enumerate}
                \item[-] {
                    Suppose $A^\prime = A$.
                    Applying \textit{7} gives $\Gamma \vdash z \chck A$.
                    Now using \textit{14}: $\Gamma \vdash t^\prime \chck A$.
                }
                \item[-] {
                    Suppose $A \betared Y$ and $Y \betastar A^\prime$.
                    Applying \textit{8} gives $\Gamma \vdash z \chck Y$.
                    Now using \textit{14}: $\Gamma \vdash t^\prime \chck A^\prime$.
                }
            \end{enumerate}
        }
    \end{enumerate}
    Suppose $\Gamma^\prime \betared \Delta$ and $\Delta \betastar \Gamma^\prime$.
    \begin{enumerate}
        \item[-] {
            Suppose $t^\prime = t$.
            Finally, pattern match on $A \betastar A^\prime$.
            \begin{enumerate}
                \item[-] {
                    Suppose $A^\prime = A$.
                    Applying \textit{1} give $\Delta \vdash t \chck A$.
                    Now using \textit{14} yields $\Gamma^\prime \vdash t \chck A$.
                }
                \item[-] {
                    Suppose $A \betared Y$ and $Y \betastar A^\prime$.
                    Deconstructing $\Gamma \vdash t \chck A$ gives $\Gamma \vdash t \infr T$, $\Gamma \vdash A \cinfr K$, and $T \equiv A$.
                    Using \textit{6} with $\Gamma \betared \Delta$ and $A \betared Y$ yields $\Delta \vdash Y \cinfr K$.
                    Now applying \textit{14} gives $\Gamma^\prime \vdash A^\prime \cinfr K$.
                    Finally, by Lemma~\ref{lem:2:conv_red_f}: $T \equiv A^\prime$.
                    Thus, $\Gamma^\prime \vdash t \chck A^\prime$.
                }
            \end{enumerate}
        }
        \item[-] {
            Suppose $t \betared z$ and $z \betastar t^\prime$.
            Finally, pattern match on $A \betastar A^\prime$.
            \begin{enumerate}
                \item[-] {
                    Suppose $A^\prime = A$.
                    Using \textit{7} gives $\Delta \vdash z \chck A$.
                    Now using \textit{14}: $\Gamma^\prime \vdash t^\prime \chck A$.
                }
                \item[-] {
                    Suppose $A \betared Y$ and $Y \betastar A^\prime$.
                    Using \textit{8} yields $\Delta \vdash z \chck Y$.
                    Now using \textit{14}: $\Gamma^\prime \vdash t^\prime \chck A^\prime$.
                }
            \end{enumerate}
        }
    \end{enumerate}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 15
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{15.}} By pattern-match on $\Gamma \vdash t \infr A$
    The \textsc{Refl}, \textsc{Int}, \textsc{Fst}, and \textsc{PrmFst} cases are omitted because they are very similar to the \textsc{Lam}, \textsc{Pi}, \textsc{Snd}, and \textsc{PrmSnd} cases respectively.

    $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{16} to $\D{1}$ gives $\Gamma, x : C^\prime, \Delta \vdash f \cinfr T$ where $(x : A) \to_m B \equiv T$
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
    \begin{proofcase}
    \end{proofcase}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 16
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{16.}}
    By pattern-match on $\Gamma \vdash t \cinfr A$

    $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
    \begin{proofcase}
        Applying \textit{15} to $\D{1}$ gives $\Gamma, x : C^\prime, \Delta \vdash t \infr A^\prime$ where $A \equiv A^\prime$ and $\Gamma \vdash A^\prime \cinfr K$.
        Pick $B^\prime = A^\prime$.
        Then $B^\prime \equiv A$ by Lemma~\ref{lem:2:conv_red_f}.
        Thus, $\Gamma, x : C^\prime, \Delta \vdash t \cinfr B^\prime$.
    \end{proofcase}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 17
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{17.}} By pattern-match on $\Gamma \vdash t \chck A$

    $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
    \begin{proofcase}
        Suppose wlog that $B \neq \kind$.
        Applying \textit{16} to $\D{1}$ gives $\Gamma, x : C^\prime, \Delta \vdash B \cinfr K$.
        Using \textit{15} with $\D{2}$ yields $\Gamma, x : C^\prime, \Delta \vdash t \infr A^\prime$ where $A \equiv A^\prime$.
        By Lemma~\ref{thm:2:conv_trans}: $A^\prime \equiv B$.
        Thus, $\Gamma, x : C^\prime, \Delta \vdash t \chck B$.
    \end{proofcase}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % 18
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \noindent \textbf{\textit{18.}} By pattern-match on $\vdash \Gamma$
    Note that the context cannot be empty.

    $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
    \begin{proofcase}
        If $\Delta \neq \varepsilon$ then the case is trivial by the IH.
        Suppose that $\Delta = \varepsilon$.
        Then $A \equiv A^\prime$ and $\Gamma \vdash A^\prime \cinfr K$.
        The \textsc{CtxApp} rule concludes the case.
    \end{proofcase}
\end{proof}







% \begin{lemma}
%     Suppose $\Gamma \vdash a \chck A$ and $A \equiv A^\prime$
%     \textcolor{white}{\_}
%     \begin{enumerate}
%         \item If $\Gamma, x : A^\prime, \Delta \vdash t \infr K$ then $\Gamma, [x := a]\Delta \vdash [x := a]t \infr K$
%         \item If $\Gamma, x : A^\prime, \Delta \vdash t \cinfr K$ then $\Gamma, [x := a]\Delta \vdash [x := a]t \cinfr K$
%         \item If $\Gamma, x : A^\prime, \Delta \vdash t \chck K$ then $\Gamma, [x := a]\Delta \vdash [x := a]t \chck K$
%         \item If $\vdash \Gamma, x : A^\prime, \Delta$ then $\vdash \Gamma, [x := a]\Delta$
%     \end{enumerate}
%     \label{lem:2:subst_check_type}
% \end{lemma}
% \begin{proof}
%     By mutual induction.

%     $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \IntersectionRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \FirstRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ReflRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteFstRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}
% \end{proof}

% \begin{lemma}
%     \textcolor{white}{\_}
%     \begin{enumerate}
%         \item If $\Gamma \vdash t \infr K$, $\Gamma \betared \Gamma^\prime$, and $t \betared t^\prime$ then $\Gamma^\prime \vdash t^\prime \infr K$
%         \item If $\Gamma \vdash t \cinfr K$, $\Gamma \betared \Gamma^\prime$, and $t \betared t^\prime$ then $\Gamma^\prime \vdash t^\prime \cinfr K$
%         \item If $\Gamma \vdash t \chck K$, $\Gamma \betared \Gamma^\prime$ and $t \betared t^\prime$ then $\Gamma^\prime \vdash t^\prime \chck K$
%         \item If $\vdash \Gamma$ and $\Gamma \betared \Gamma^\prime$ then $\vdash \Gamma^\prime$
%     \end{enumerate}
%     where $K = \star$ or $K = \kind$
%     \label{lem:b:type_preservation_step}
% \end{lemma}
% \begin{proof}
%     By mutual induction.
%     The \textsc{Lambda}, \textsc{Pair}, \textsc{Refl}, \textsc{Subst}, \textsc{PrmFst}, \textsc{PrmSnd}, \textsc{Cast}, and \textsc{Sep} cases are omitted because the inferred type cannot be equal to $K$.

%     $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
%     \begin{proofcase}
%         By cases on $t \betared t^\prime$.

%         $\text{Case: }\begin{array}{c} \app{(\abs{\lambda_m}{x}{Q}{b})}{m}{a} \betared [x := a]b \end{array}$
%         \begin{proofcase}
%             TODO
%         \end{proofcase}

%         $\text{Case: }\begin{array}{c} a \betared a^\prime \end{array}$
%         \begin{proofcase}
%         \end{proofcase}

%         $\text{Case: }\begin{array}{c} f \betared f^\prime \end{array}$
%         \begin{proofcase}
%         \end{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \IntersectionRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \FirstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteFstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}
% \end{proof}


% \begin{lemma}
%     Suppose $\Gamma \vdash A^\prime \cinfr K$ and $A \betastar A^\prime$
%     \textcolor{white}{\_}
%     \begin{enumerate}
%         \item If $\Gamma, x : A, \Delta \vdash t \infr B$ then $\exists\ B^\prime.$ $B \betastar B^\prime$ and $\Gamma, x : A^\prime, \Delta \vdash t \infr B^\prime$
%         \item If $\Gamma, x : A, \Delta \vdash t \cinfr B$ then $\exists\ B^\prime.$ $B \betastar B^\prime$ and $\Gamma, x : A^\prime, \Delta \vdash t \cinfr B^\prime$
%         \item If $\Gamma, x : A, \Delta \vdash t \chck B$ then $\Gamma, x : A^\prime, \Delta \vdash t \chck B$
%         \item If $\vdash \Gamma, x : A, \Delta$ then $\vdash \Gamma, x : A^\prime, \Delta$
%     \end{enumerate}
%     \label{lem:2:check_ctx}
% \end{lemma}
% \begin{proof}
%     By mutual induction.
%     The \textsc{Int} rule is omitted as it is similar to the \textsc{Pi} rule.
%     Rules \textsc{Fst} and \textsc{PrmFst} are omitted because they are very similar to \textsc{Snd} and \textsc{PrmSnd} respectively.
%     The \textsc{Sep} and \textsc{Ax} rules are immediate by the IH and thus omitted.

%     $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
%     \begin{proofcase}
%         Rename to $y : C$.
%         Applying the IH to $\D{1}$ gives $\vdash \Gamma, x : A^\prime, \Delta$.
%         If $y \neq x$ then $\Gamma, x : A^\prime, \Delta \vdash y \infr C$.
%         Otherwise, $\Gamma, x : A^\prime, \Delta \vdash y \infr A^\prime$ and $A = C$, but also $A \equiv A^\prime$.
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
%     \begin{proofcase}
%         Note that from past arguments $\pdom(m, K) \equiv T$ where $T$ is part of a judgment means that $T = \pdom(m, K)$ and likewise for $\pcodom(m)$.
%         With that in mind this case is discharge by the IH on both $\D{1}$ and $\D{2}$.
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
%     \begin{proofcase}
%         As with the previous case: $\Gamma, x : A^\prime, \Delta \vdash A \cinfr \pdom(m, K)$.
%         Applying the IH to $\D{2}$ gives $\exists\ B^\prime$ such that $B \equiv B^\prime$ and $\Gamma, x : A^\prime, \Delta, y : C \vdash t \infr B^\prime$.


%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
%     \begin{proofcase}
%         Applying the IH to $\D{1}$ gives $\exists\ T$ such that $(x : A) \to_m B \betastar T$ and $\Gamma, x_m : U^\prime, \Delta \vdash T$.
%         By inversion $T = (x : C) \to_m D$ where $A \betastar C$ and $B \betastar D$.

%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ReflRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
%     \begin{proofcase}
%         TODO
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
%     \begin{proofcase}
%         By the IH applied to $\D{1}$: $\exists\ T$ such that $C \equiv T$ and $\Gamma, x : A^\prime, \Delta \vdash t \infr T$.
%         Pick $B^\prime = T$.
%         Now by Lemma~\ref{lem:2:conv_red_f} applied with $\D{2}$ to $C \equiv T$: $B \equiv T$.
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
%     \begin{proofcase}
%         Applying the IH to $\D{2}$ gives $\exists\ C^\prime$ such that $C \equiv C^\prime$ and $\Gamma, x : A^\prime, \Delta \vdash t \infr C^\prime$.
%         By Lemma~\ref{thm:2:conv_trans}: $C \equiv B$.
%         W.l.o.g. assume $\Gamma, x : A, \Delta \vdash B \cinfr K$.
%         Using the IH on this derivation gives $\exists\ T$ such that $T \equiv K$ and $\Gamma, x : A^\prime, \Delta \vdash B \cinfr T$.
%         For any possibility of $K = \star$ or $K = \kind$ it forces $T = K$.
%         Thus, $\Gamma, x : A^\prime, \Delta \vdash t \chck B$.
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
%     \begin{proofcase}
%         Impossible, premise assumes the context is non-empty.
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
%     \begin{proofcase}
%         Rename to $y : C$.
%         Have $\vdash \Gamma, x : A, \Delta, y : C$.
%         By the IH applied to $\D{2}$: $\vdash \Gamma, x : A^\prime, \Delta$.
%         Applying the IH to $\D{3}$ gives $\exists\ T$ such that $K \equiv T$ and $\Gamma, x : A^\prime, \Delta \vdash C \cinfr T$.
%         Note if $K = \kind$ then $T = \kind$ because of Lemma~\ref{lem:2:kind_not_type}.
%         If $K = \star$ then $T = \star$ by Lemma~\ref{lem:2:star_type_valid}.
%         Thus, $\vdash \Gamma, x : A^\prime, \Delta, y : C$.
%     \end{proofcase}
% \end{proof}

% \begin{lemma}[Substitution of Checking]
%     Suppose $\Gamma \vdash b \infr B^\prime$ and $B^\prime \equiv B$.
%     \begin{enumerate}
%         \item If $\Gamma, x : B, \Delta \vdash t \infr A$ then $\exists\ A^\prime.$ $A \equiv A^\prime$ and $\Gamma, [x := b]\Delta \vdash [x := b]t \infr [x := b]A^\prime$
%         \item If $\Gamma, x : B, \Delta \vdash t \cinfr A$ then $\exists\ A^\prime.$ $A \equiv A^\prime$ and $\Gamma, [x := b]\Delta \vdash [x := b]t \cinfr [x := b]A^\prime$
%         \item If $\Gamma, x : B, \Delta \vdash t \chck A$ then $\Gamma, [x := b]\Delta \vdash [x := b]t \chck [x := b]A$
%         \item If $\vdash \Gamma, x : B, \Delta$ then $\vdash \Gamma, [x := b]\Delta$
%     \end{enumerate}
%     \label{lem:2:subst_check}
% \end{lemma}

% \begin{proof}
%     By mutual induction.

%     $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \IntersectionRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \FirstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ReflRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteFstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}
% \end{proof}

% % \begin{proof}
% %     Deconstructing $\Gamma \vdash b \chck B$ gives $\exists\ T$ such that $\Gamma \vdash b \infr T$, $\Gamma \vdash T \cinfr K$, and $T \equiv B$.
% %     \begin{enumerate}
% %         \item[1.-3.] {
% %             By Lemma~\ref{lem:2:check_ctx}: $\Gamma, x : T, \Delta \vdash t \chck A$.
% %             Applying Lemma~\ref{lem:2:subst_infer} gives $\Gamma, [x := b]\Delta \vdash [x := b]t \chck [x := b]A$.
% %         }
% %         \item[4.] {
% %             By Lemma~\ref{lem:2:check_ctx}: $\vdash \Gamma, x : T, \Delta$.
% %             Applying Lemma~\ref{lem:2:subst_infer} gives $\vdash \Gamma, [x := b]\Delta$.
% %         }
% %     \end{enumerate}
% % \end{proof}

% \begin{lemma}
%     If $\Gamma \vdash a \chck T$, $\Gamma \vdash A \cinfr K$, and $T \equiv A$ then $\Gamma \vdash a \chck A$
%     \label{lem:2:check_preserved_by_conv}
% \end{lemma}
% \begin{proof}
%     Deconstruct $\Gamma \vdash a \chck T$ to obtain $\exists\ T^\prime$ such that $\Gamma \vdash a \infr T^\prime$, $\Gamma \vdash T^\prime \cinfr K$, and $T^\prime \equiv T$.
%     Note that by Lemma~\ref{lem:2:infer_is_pseobj} and Lemma~\ref{lem:2:infer_type_is_pseobj} $A, T, T^\prime\pseobj$.
%     Thus, by Lemma~\ref{thm:2:conv_trans} $T \equiv A$.
%     Therefore, $\Gamma \vdash a \chck A$.
% \end{proof}


% \begin{lemma}
%     \textcolor{white}{\_}
%     \begin{enumerate}
%         \item If $\Gamma \vdash t \infr A$, $\Gamma \betared \Gamma^\prime$, and $t \betared t^\prime$ then $\exists\ B.$ $A \equiv B$ and $\Gamma^\prime \vdash t^\prime \infr B$
%         \item If $\Gamma \vdash t \cinfr A$, $\Gamma \betared \Gamma^\prime$, and $t \betared t^\prime$ then $\exists\ B.$ $A \equiv B$ and $\Gamma^\prime \vdash t^\prime \cinfr B$
%         \item If $\Gamma \vdash t \chck A$, $\Gamma \betared \Gamma^\prime$, $t \betared t^\prime$, and $A \betared A^\prime$ then $\Gamma^\prime \vdash t^\prime \chck A^\prime$
%         \item If $\vdash \Gamma$ and $\Gamma \betared \Gamma^\prime$ then $\vdash \Gamma^\prime$
%     \end{enumerate}
%     \label{lem:b:preservation_par_step}
% \end{lemma}
% \begin{proof}
%     By mutual induction.

%     $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
%     \begin{proofcase}
%         By cases on $t \betared t^\prime$.

%         $\text{Case: }\begin{array}{c} \app{(\abs{\lambda_m}{x}{Q}{b})}{m}{a} \betared [x := a]b \end{array}$
%         \begin{proofcase}
%             Have $\Gamma \vdash \abs{\lambda_m}{x}{Q}{b} \cinfr (x : A) \to_m B$, thus $\exists\ T$ such that $T \betastar (x : A) \to_m B$ and $\Gamma \vdash \abs{\lambda_m}{x}{Q}{b} \infr T$.
%             By inversion on $T \betastar (x : A) \to_m B$: $T = (x : C) \to_m D$ where $C \betastar A$ and $D \betastar B$.
%             Note $Q = C$ by inversion.
%             Thus, $\Gamma \vdash \abs{\lambda_m}{x}{C}{b} \infr (x : C) \to_m D$.
%             Deconstructing gives $\Gamma, x : C \vdash t \infr D$.
%             Deconstructing $\D{2}$ yields $\exists\ T$ such that $\Gamma \vdash a \infr T$ and $T \equiv A$.

%         \end{proofcase}

%         $\text{Case: }\begin{array}{c} a \betared a^\prime \end{array}$
%         \begin{proofcase}
%         \end{proofcase}

%         $\text{Case: }\begin{array}{c} f \betared f^\prime \end{array}$
%         \begin{proofcase}
%         \end{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \IntersectionRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \FirstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ReflRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteFstRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \PromoteSndRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}

%     $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
%     \begin{proofcase}
%     \end{proofcase}
% \end{proof}

\begin{theorem}[Classification]
    If $\Gamma \vdash t \infr A$ then one (and only one) of the following statements holds:
    \begin{enumerate}
        \item $A$ is $\kind$ (i.e. $t$ is a kind)
        \item $\Gamma \vdash A \cinfr \kind$ (i.e. $t$ is a $\Gamma$-constructor)
        \item $\Gamma \vdash A \cinfr \star$ (i.e. $t$ is a $\Gamma$-term)
    \end{enumerate}
\end{theorem}
\begin{proof}
    By induction on the proof derivation of $t$ with motives
    \begin{itemize}
        \item {
            $\Gamma \vdash t \infr A$, $\Gamma \vdash t \cinfr A$, and $\Gamma \vdash t \chck A$ motives is
            $$(A = \kind) \vee (\Gamma \vdash A \cinfr \kind) \vee (\Gamma \vdash A \cinfr \star)$$
        }
        \item {
            $\vdash \Gamma$ motive is $\top$
        }
    \end{itemize}

    $\text{Case: }\begin{array}{c} \AxiomRule[*] \end{array}$
    \begin{proofcase}
        $A = \kind$, trivial.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \VarRule[*] \end{array}$
    \begin{proofcase}
        Obtained from Lemma~\ref{lem:2:ctx_get}.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PiRule[*] \end{array}$
    \begin{proofcase}
        If $\pcodom(m) = \kind$ then trivial.
        Otherwise, $\pcodom(m) = \star$ and the \textsc{Axiom} rule with Lemma~\ref{lem:2:ctx_wf} applied to $\D{1}$ conclude the case.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \LambdaRule[*] \end{array}$
    \begin{proofcase}
        Apply the \textsc{Pi} rule with $\D{1}$ and $\D{3}$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \AppRule[*] \end{array}$
    \begin{proofcase}
        By the IH applied to $\D{1}$ it is the case that $\exists\ K$ such that $\Gamma \vdash (x : A) \to_m B \cinfr K$.
        Note that it cannot be the case that it is equal $\kind$ by inversion on syntax.
        However, by inversion on the internal inference rule $\Gamma \vdash (x : A) \to_m B \infr \pcodom(m)$.
        By the \textsc{Pi} rule $\Gamma, x : A \vdash B \cinfr \pcodom(m)$.
        Applying Lemma~\ref{lem:2:subst_check} yields $\Gamma \vdash [x := a]B \chck \pcodom(m)$.
        Thus, by Lemma~\ref{lem:2:check_k_to_cinfer_k}: $\Gamma \vdash [x := a]B \cinfr \pcodom(m)$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \IntersectionRule[*] \end{array}$
    \begin{proofcase}
        Immediate by the \textsc{Axiom} rule and Lemma~\ref{lem:2:ctx_get}.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PairRule[*] \end{array}$
    \begin{proofcase}
        Apply the \textsc{Int} rule with $\D{2}$ and $\D{3}$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \FirstRule[*] \end{array}$
    \begin{proofcase}
        Apply the IH to $\D{1}$.
        Inversion on syntax gives $\exists\ K$ such that $(x : A) \cap B \cinfr K$.
        Inversion on the internal inference rule yields $(x : A) \cap B \infr \star$.
        Thus, $K = \star$.
        Deconstructing the previous rule concludes the proof with $\Gamma \vdash A \cinfr \star$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SecondRule[*] \end{array}$
    \begin{proofcase}
        Exactly as the previous case $(x : A) \cap B \infr \star$ by the IH and two inversions.
        Deconstructing the previous rule gives $\Gamma, x : A \vdash B \cinfr \star$.
        By the \textsc{Fst} rule, $\Gamma \vdash t.1 \infr A$.
        Then, by Lemma~\ref{lem:2:subst_infer} it is the case that $\Gamma \vdash [x := t.1]B \cinfr \star$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \EqualityRule[*] \end{array}$
    \begin{proofcase}
        Immediate by the \textsc{Axiom} rule and Lemma~\ref{lem:2:ctx_wf}.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ReflRule[*] \end{array}$
    \begin{proofcase}
        Note that $\Gamma \vdash t \chck A$, thus by the \textsc{Eq} rule $\Gamma \vdash t =_A t \infr \star$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SubstRule[*] \end{array}$
    \begin{proofcase}
        Apply the IH to $\D{1}$.
        By inversion on syntax $\exists\ K$ such that $\Gamma \vdash a =_A b \cinfr K$.
        By inversion on the internal inference rule, $\Gamma \vdash a =_A b \infr \star$, thus $K = \star$.
        Deconstructing the previous rule yields $\Gamma \vdash A \cinfr \star$, $\Gamma \vdash a \chck A$, and $\Gamma \vdash b \chck A$.
        By Lemma~\ref{lem:2:check_app} $\Gamma \vdash \app{P}{\tau}{a} \chck \star$ and $\Gamma \vdash \app{P}{\tau}{b} \chck \star$.
        However, this means that $\Gamma \vdash \app{P}{\tau}{a} \cinfr \star$ and $\Gamma \vdash \app{P}{\tau}{b} \cinfr \star$ by Lemma~\ref{lem:2:check_k_to_cinfer_k}.
        Using weakening, $\Gamma, x : \app{P}{\tau}{a} \vdash \app{P}{\tau}{b} \cinfr \star$.
        Applying the \textsc{Pi} rule concludes the proof.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \PromoteFstRule[*] \end{array}$
    \begin{proofcase}
        Exactly as the \textsc{Fst} and \textsc{Snd} cases, $\Gamma \vdash (x : A) \cap B \cinfr \star$ by the IH and two inversions.
        By $\D{2}$, $\Gamma \vdash a \chck (x : A) \cap B$.
        Applying the \textsc{Eq} rule yields $\Gamma \vdash a =_{(x : A) \cap B} b \infr \star$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CastRule[*] \end{array}$
    \begin{proofcase}
        By the IH on $\D{1}$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \SeparationRule[*] \end{array}$
    \begin{proofcase}
        It is clear that $\Gamma \vdash (X : \star) \to_0 X \infr \star$ by applying a short sequence of inference rules.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \HeadInferenceRule[*] \end{array}$
    \begin{proofcase}
        Apply the IH on $\D{1}$.
        By inversion on $\D{2}$, $A \neq \kind$.
        Thus, $\exists\ K$ such that $\Gamma \vdash A \cinfr K$.
        By preservation $\Gamma \vdash B \cinfr K$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \CheckRule[*] \end{array}$
    \begin{proofcase}
        Immediate by $\D{2}$.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextEmptyRule[*] \end{array}$
    \begin{proofcase}
        Trivial.
    \end{proofcase}

    $\text{Case: }\begin{array}{c} \ContextAppendRule[*] \end{array}$
    \begin{proofcase}
        Trivial.
    \end{proofcase}
\end{proof}
