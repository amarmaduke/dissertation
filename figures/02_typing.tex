
\newcommand{\Rule}[4]{
    \newcommand{#1}[1][a]{
        \if##1a
        \renewcommand{\der}[2]{####2}
        \else
        \renewcommand{\der}[2]{\stackrel{####1}{####2}}
        \fi
        \inferrule{#2}{#3}
        \textsc{#4}
        \renewcommand{\der}[2]{####2}
    }
}

\Rule{\AxiomRule}
    {\der{\D{1}}{\vdash \Gamma}}
    {\Gamma \vdash \star \infr \square}
    {Axiom}

\Rule{\VarRule}
    {
        \der{\D{1}}{\vdash \Gamma}
        \\ \der{\D{2}}{(x : A) \in \Gamma}
    }
    {\Gamma \vdash x \infr A}
    {Var}

\Rule{\PiRule}
    {
        \der{\D{1}}{\Gamma \vdash A \cinfr \text{dom}_\Pi(m, K)}
        \\ \der{\D{2}}{\Gamma, x:A \vdash B \cinfr \text{codom}_\Pi(m)}
    }
    {\Gamma \vdash (x : A) \to_m B \infr \text{codom}_\Pi(m)}
    {Pi}

\Rule{\LambdaRule}
    {
        \der{\D{1}}{\Gamma \vdash A \cinfr \text{dom}_\Pi(m, K)}
        \\ \der{\D{2}}{\Gamma, x:A \vdash t \infr B}
        \\ \der{\D{3}}{x \notin \text{FV}(|t|)\text{ if } m = 0}
    }
    {\Gamma \vdash \abs{\lambda_m}{x}{A}{t} : (x : A) \to_m B}
    {Lambda}

\Rule{\AppRule}
    {
        \der{\D{1}}{\Gamma \vdash f \cinfr (x : A) \to_m B} \\
        \der{\D{2}}{\Gamma \vdash a \chck A}
    }
    {\Gamma \vdash \app{f}{m}{a} \infr [x := a]B}
    {App}

\Rule{\IntersectionRule}
    {
        \der{\D{1}}{\Gamma \vdash A \cinfr \star} \\
        \der{\D{1}}{\Gamma, x:A \vdash B \cinfr \star}
    }
    {\Gamma \vdash (x : A) \cap B \infr \star}
    {Intersection}

\Rule{\PairRule}
    {
        \der{\D{1}}{\Gamma \vdash T \cinfr (x : A) \to_\tau B} \\
        \der{\D{2}}{\Gamma \vdash t \chck A} \\
        \der{\D{3}}{\Gamma \vdash s \chck [x := t]B} \\
        \der{\D{4}}{t \equiv s}
    }
    {\Gamma \vdash [t, s; T] \infr (x : A) \cup B }
    {Pair}

\Rule{\FirstRule}
    {\der{\D{1}}{\Gamma \vdash t \cinfr (x:A) \cap B}}
    {\Gamma \vdash t.1 \infr A}
    {First}

\Rule{\SecondRule}
    {\der{\D{1}}{\Gamma \vdash t \cinfr (x:A) \cap B}}
    {\Gamma \vdash t.2 \infr [x := t.1]B}
    {Second}

\Rule{\EqualityRule}
    {
        \der{\D{1}}{\Gamma \vdash A \cinfr \star} \\
        \der{\D{2}}{\Gamma \vdash a \chck A} \\
        \der{\D{2}}{\Gamma \vdash b \chck A}
    }
    {\Gamma \vdash a =_A b \infr \star}
    {Equality}

\Rule{\ReflRule}
    {\der{\D{1}}{\Gamma \vdash t \infr A}}
    {\Gamma \vdash \text{refl}\ t \infr t =_A t}
    {Refl}

\Rule{\EqualityInductionRule}
    {
        \der{\D{1}}{\Gamma \vdash A \cinfr \star} \\
        \der{\D{2}}{
            \Gamma \vdash P \chck (x\ y : A) \to_\tau (e : x =_A y) \to_\tau \star
        } \\
        \der{\D{3}}{\Gamma \vdash x \chck A} \\
        \der{\D{4}}{\Gamma \vdash y \chck A} \\
        \der{\D{5}}{\Gamma \vdash r \chck x =_A y} \\
        \der{\D{6}}{
            \Gamma \vdash w \chck (a : A) \to_0
                \appthr{P}{\tau}{a}{\tau}{a}{\tau}{\text{refl}\ a}
        }
    }
    {\Gamma \vdash J\ A\ P\ x\ y\ r\ w \infr \appthr{P}{\tau}{x}{\tau}{y}{\tau}{r}}
    {EqInduct}

\Rule{\PromoteRule}
    {
        \der{\D{1}}{\Gamma \vdash e \cinfr a.1 =_T b.1} \\
        \der{\D{2}}{\Gamma \vdash a \cinfr (x:A) \cap B} \\
        \der{\D{3}}{\Gamma \vdash b \chck (x:A) \cap B} \\
        \der{\D{4}}{T \equiv A}
    }
    {\Gamma \vdash \vartheta\ e \infr a =_{(x:A) \cap B} b}
    {Promote}

\Rule{\CastRule}
    {
        \der{\D{1}}{\Gamma \vdash b \cinfr (x:A) \cap B} \\
        \der{\D{2}}{\Gamma \vdash a \chck A} \\
        \der{\D{3}}{\Gamma \vdash e \chck a =_A b.1} \\
        \der{\D{4}}{\text{FV}(|e|) \subseteq \text{FV}(|a|)}
    }
    {\Gamma \vdash \varphi\ a\ b\ e \infr (x:A) \cap B}
    {Cast}

\Rule{\SeparationRule}
    {
        \text{cBool} := (X : \star) \to_0 (x : X) \to_\omega (y : X) \to_\omega X \\
        \text{ctt} := \abs{\lambda_0}{X}{\star}{
            \abs{\lambda_\omega}{x}{X}{
                \abs{\lambda_\omega}{y}{X}{x}
            }
        } \\
        \text{cff} := \abs{\lambda_0}{X}{\star}{
            \abs{\lambda_\omega}{x}{X}{
                \abs{\lambda_\omega}{y}{X}{y}
            }
        } \\
        \Gamma \vdash e \chck \text{ctt} =_{\text{cBool}} \text{cff}
    }
    {\Gamma \vdash \delta\ e \infr (X : \star) \to_0 X}
    {Separation}

\Rule{\HeadInferenceRule}
    {
        \der{\D{1}}{\Gamma \vdash t \infr A} \\
        \der{\D{2}}{A \betastar B}
    }
    {\Gamma \vdash t \cinfr B}
    {HeadInference}

\Rule{\CheckRule}
    {
        \der{\D{1}}{\Gamma \vdash t \infr A} \\
        \der{\D{2}}{\Gamma \vdash B \cinfr K} \\
        \der{\D{2}}{A \equiv B}
    }  
    {\Gamma \vdash t \chck B}
    {Checking}

\Rule{\ContextEmptyRule}
    {\color{white}{\_}}
    {\vdash \cdot}
    {ContextEmpty}

\Rule{\ContextAppendRule}
    {
        \der{\D{1}}{x \notin \text{FV}(\Gamma)} \\
        \der{\D{2}}{\vdash \Gamma} \\
        \der{\D{3}}{\Gamma \vdash A \cinfr K}
    }
    {\vdash \Gamma, x:A}
    {ContextAppend}

\begin{align*}
    \text{dom}_\Pi(\omega, K) &= \star \\
    \text{dom}_\Pi(\tau, K) &= K \\
    \text{dom}_\Pi(0, K) &= K
\end{align*}

\begin{align*}
    \text{codom}_\Pi(\omega) &= \star \\
    \text{codom}_\Pi(\tau) &= \square \\
    \text{codom}_\Pi(0) &= \star
\end{align*}

\begin{align*}
    \app{(\abs{\lambda_m}{x}{t_1}{t_2})}{m}{t3} &\betared [ x := t_3]t_2 \\
    [t_1, t_2, t_3].1 &\betared t_1 \\
    [t_1, t_2, t_3].2 &\betared t_2 \\
    J\ t_1\ t_2\ t_3\ t_4\ (\text{refl}\ t_5)\ t_6 &\betared \app{t_6}{0}{t_5} \\
    \vartheta\ (\text{refl}\ t.1) &\betared \text{refl}\ t \\
    \varphi\ t_1\ t_2\ (\text{refl}\ t_3) &\betared t_2
\end{align*}

\begin{align*}
    |x| &= x \\
    |\star| &= \star \\
    |\square| &= \square \\
    |\abs{\lambda_0}{x}{A}{t}| &= |t| \\
    |\abs{\lambda_\omega}{x}{A}{t}| &= \absu{\lambda_\omega}{x}{|t|} \\
    |\abs{\lambda_\tau}{x}{A}{t}| &= \abs{\lambda_\tau}{x}{|A|}{|t|} \\
    |(x:A) \to_m B| &= (x:|A|) \to_m |B| \\
    |(x:A) \cap B| &= (x:|A|) \cap |B| \\
    |\app{f}{0}{a}| &= |f| \\
    |\app{f}{\omega}{a}| &= \app{|f|}{\omega}{|a|} \\
    |\app{f}{\tau}{a}| &= \app{|f|}{\tau}{|a|} \\
    |[s, t, T]| &= |t| \\
    |t.1| &= |t| \\
    |t.2| &= |t| \\
    |x =_A y| &= |x| =_{|A|} |y| \\
    |\text{refl}\ t| &= \absu{\lambda_\omega}{x}{x} \\
    |J\ A\ P\ x\ y\ r\ w| &= |r|\ |w| \\
    |\vartheta\ e| &= |e| \\
    |\delta\ e| &= |e| \\
    |\varphi\ a\ b\ e| &= |a|
\end{align*}

\[\arraycolsep=2pt\def\arraystretch{2.5}
    \begin{array}{c}
        \AxiomRule \\
        \VarRule \\
        \PiRule \\
        \LambdaRule \\
        \AppRule \\
        \IntersectionRule \\
        \PairRule \\
        \FirstRule \\
        \SecondRule \\
        \EqualityRule \\
        \ReflRule
    \end{array}
\]
\[\arraycolsep=6pt\def\arraystretch{5}
    \begin{array}{c}
        \EqualityInductionRule \\
        \PromoteRule \\
        \CastRule \\
        \SeparationRule
    \end{array}
\]
\[\arraycolsep=2pt\def\arraystretch{2.5}
    \begin{array}{c}
        \HeadInferenceRule \\
        \CheckRule \\
        \ContextEmptyRule \\
        \ContextAppendRule
    \end{array}
\]





